{"id":"../node_modules/react-stockcharts/lib/series/VolumeProfileSeries.js","dependencies":[{"name":"/home/hemanth/Desktop/Itarle/OpenFinWithReactReduxParcel/node_modules/react-stockcharts/lib/series/VolumeProfileSeries.js.map","includedInParent":true,"mtime":1536032206000},{"name":"/home/hemanth/Desktop/Itarle/OpenFinWithReactReduxParcel/package.json","includedInParent":true,"mtime":1602365273866},{"name":"/home/hemanth/Desktop/Itarle/OpenFinWithReactReduxParcel/public/.babelrc","includedInParent":true,"mtime":1602365273866},{"name":"/home/hemanth/Desktop/Itarle/OpenFinWithReactReduxParcel/node_modules/react-stockcharts/package.json","includedInParent":true,"mtime":1602365360568},{"name":"react","loc":{"line":13,"column":21},"parent":"/home/hemanth/Desktop/Itarle/OpenFinWithReactReduxParcel/node_modules/react-stockcharts/lib/series/VolumeProfileSeries.js","resolved":"/home/hemanth/Desktop/Itarle/OpenFinWithReactReduxParcel/node_modules/react/react.js"},{"name":"prop-types","loc":{"line":17,"column":25},"parent":"/home/hemanth/Desktop/Itarle/OpenFinWithReactReduxParcel/node_modules/react-stockcharts/lib/series/VolumeProfileSeries.js","resolved":"/home/hemanth/Desktop/Itarle/OpenFinWithReactReduxParcel/node_modules/prop-types/index.js"},{"name":"d3-array","loc":{"line":21,"column":23},"parent":"/home/hemanth/Desktop/Itarle/OpenFinWithReactReduxParcel/node_modules/react-stockcharts/lib/series/VolumeProfileSeries.js","resolved":"/home/hemanth/Desktop/Itarle/OpenFinWithReactReduxParcel/node_modules/d3-array/src/index.js"},{"name":"d3-collection","loc":{"line":23,"column":28},"parent":"/home/hemanth/Desktop/Itarle/OpenFinWithReactReduxParcel/node_modules/react-stockcharts/lib/series/VolumeProfileSeries.js","resolved":"/home/hemanth/Desktop/Itarle/OpenFinWithReactReduxParcel/node_modules/d3-collection/src/index.js"},{"name":"d3-scale","loc":{"line":25,"column":23},"parent":"/home/hemanth/Desktop/Itarle/OpenFinWithReactReduxParcel/node_modules/react-stockcharts/lib/series/VolumeProfileSeries.js","resolved":"/home/hemanth/Desktop/Itarle/OpenFinWithReactReduxParcel/node_modules/d3-scale/index.js"},{"name":"../GenericChartComponent","loc":{"line":27,"column":37},"parent":"/home/hemanth/Desktop/Itarle/OpenFinWithReactReduxParcel/node_modules/react-stockcharts/lib/series/VolumeProfileSeries.js","resolved":"/home/hemanth/Desktop/Itarle/OpenFinWithReactReduxParcel/node_modules/react-stockcharts/lib/GenericChartComponent.js"},{"name":"../GenericComponent","loc":{"line":31,"column":32},"parent":"/home/hemanth/Desktop/Itarle/OpenFinWithReactReduxParcel/node_modules/react-stockcharts/lib/series/VolumeProfileSeries.js","resolved":"/home/hemanth/Desktop/Itarle/OpenFinWithReactReduxParcel/node_modules/react-stockcharts/lib/GenericComponent.js"},{"name":"../utils","loc":{"line":33,"column":21},"parent":"/home/hemanth/Desktop/Itarle/OpenFinWithReactReduxParcel/node_modules/react-stockcharts/lib/series/VolumeProfileSeries.js","resolved":"/home/hemanth/Desktop/Itarle/OpenFinWithReactReduxParcel/node_modules/react-stockcharts/lib/utils/index.js"}],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _react = require(\"react\");\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require(\"prop-types\");\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _d3Array = require(\"d3-array\");\n\nvar _d3Collection = require(\"d3-collection\");\n\nvar _d3Scale = require(\"d3-scale\");\n\nvar _GenericChartComponent = require(\"../GenericChartComponent\");\n\nvar _GenericChartComponent2 = _interopRequireDefault(_GenericChartComponent);\n\nvar _GenericComponent = require(\"../GenericComponent\");\n\nvar _utils = require(\"../utils\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar VolumeProfileSeries = function (_Component) {\n\t_inherits(VolumeProfileSeries, _Component);\n\n\tfunction VolumeProfileSeries(props) {\n\t\t_classCallCheck(this, VolumeProfileSeries);\n\n\t\tvar _this = _possibleConstructorReturn(this, (VolumeProfileSeries.__proto__ || Object.getPrototypeOf(VolumeProfileSeries)).call(this, props));\n\n\t\t_this.renderSVG = _this.renderSVG.bind(_this);\n\t\t_this.drawOnCanvas = _this.drawOnCanvas.bind(_this);\n\t\treturn _this;\n\t}\n\n\t_createClass(VolumeProfileSeries, [{\n\t\tkey: \"drawOnCanvas\",\n\t\tvalue: function drawOnCanvas(ctx, moreProps) {\n\t\t\tvar xAccessor = moreProps.xAccessor,\n\t\t\t    width = moreProps.width;\n\n\t\t\tvar _helper = helper(this.props, moreProps, xAccessor, width),\n\t\t\t    rects = _helper.rects,\n\t\t\t    sessionBg = _helper.sessionBg;\n\n\t\t\t_drawOnCanvas(ctx, this.props, rects, sessionBg);\n\t\t}\n\t}, {\n\t\tkey: \"render\",\n\t\tvalue: function render() {\n\t\t\treturn _react2.default.createElement(_GenericChartComponent2.default, {\n\t\t\t\tsvgDraw: this.renderSVG,\n\t\t\t\tcanvasDraw: this.drawOnCanvas,\n\t\t\t\tcanvasToDraw: _GenericComponent.getAxisCanvas,\n\t\t\t\tdrawOn: [\"pan\"]\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: \"renderSVG\",\n\t\tvalue: function renderSVG(moreProps) {\n\t\t\tvar _props = this.props,\n\t\t\t    className = _props.className,\n\t\t\t    opacity = _props.opacity;\n\t\t\tvar _props2 = this.props,\n\t\t\t    showSessionBackground = _props2.showSessionBackground,\n\t\t\t    sessionBackGround = _props2.sessionBackGround,\n\t\t\t    sessionBackGroundOpacity = _props2.sessionBackGroundOpacity;\n\t\t\tvar xAccessor = moreProps.xAccessor,\n\t\t\t    width = moreProps.width;\n\n\t\t\tvar _helper2 = helper(this.props, moreProps, xAccessor, width),\n\t\t\t    rects = _helper2.rects,\n\t\t\t    sessionBg = _helper2.sessionBg;\n\n\t\t\tvar sessionBgSvg = showSessionBackground ? sessionBg.map(function (d, idx) {\n\t\t\t\treturn _react2.default.createElement(\"rect\", _extends({ key: idx }, d, { opacity: sessionBackGroundOpacity, fill: sessionBackGround }));\n\t\t\t}) : null;\n\n\t\t\treturn _react2.default.createElement(\n\t\t\t\t\"g\",\n\t\t\t\t{ className: className },\n\t\t\t\tsessionBgSvg,\n\t\t\t\trects.map(function (d, i) {\n\t\t\t\t\treturn _react2.default.createElement(\n\t\t\t\t\t\t\"g\",\n\t\t\t\t\t\t{ key: i },\n\t\t\t\t\t\t_react2.default.createElement(\"rect\", { x: d.x, y: d.y,\n\t\t\t\t\t\t\twidth: d.w1, height: d.height,\n\t\t\t\t\t\t\tfill: d.fill1, stroke: d.stroke1, fillOpacity: opacity }),\n\t\t\t\t\t\t_react2.default.createElement(\"rect\", { x: d.x + d.w1, y: d.y,\n\t\t\t\t\t\t\twidth: d.w2, height: d.height,\n\t\t\t\t\t\t\tfill: d.fill2, stroke: d.stroke2, fillOpacity: opacity })\n\t\t\t\t\t);\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t}]);\n\n\treturn VolumeProfileSeries;\n}(_react.Component);\n\nVolumeProfileSeries.propTypes = {\n\tclassName: _propTypes2.default.string,\n\topacity: _propTypes2.default.number,\n\tshowSessionBackground: _propTypes2.default.bool,\n\tsessionBackGround: _propTypes2.default.string,\n\tsessionBackGroundOpacity: _propTypes2.default.number\n};\n\nVolumeProfileSeries.defaultProps = {\n\tclassName: \"line \",\n\tbins: 20,\n\topacity: 0.5,\n\tmaxProfileWidthPercent: 50,\n\tfill: function fill(_ref) {\n\t\tvar type = _ref.type;\n\t\treturn type === \"up\" ? \"#6BA583\" : \"#FF0000\";\n\t},\n\tstroke: \"#FFFFFF\",\n\tshowSessionBackground: false,\n\tsessionBackGround: \"#4682B4\",\n\tsessionBackGroundOpacity: 0.3,\n\n\tsource: function source(d) {\n\t\treturn d.close;\n\t},\n\tvolume: function volume(d) {\n\t\treturn d.volume;\n\t},\n\tabsoluteChange: function absoluteChange(d) {\n\t\treturn d.absoluteChange;\n\t},\n\tbySession: false,\n\t/* eslint-disable no-unused-vars */\n\tsessionStart: function sessionStart(_ref2) {\n\t\tvar d = _ref2.d,\n\t\t    i = _ref2.i,\n\t\t    plotData = _ref2.plotData;\n\t\treturn i > 0 && plotData[i - 1].date.getMonth() !== d.date.getMonth();\n\t},\n\t/* eslint-enable no-unused-vars */\n\torient: \"left\",\n\t// // fill: ({ type }) => { var c = type === \"up\" ? \"#6BA583\" : \"#FF0000\"; console.log(type, c); return c },\n\t// stroke: ({ type }) =>  type === \"up\" ? \"#6BA583\" : \"#FF0000\",\n\t// stroke: \"none\",\n\tpartialStartOK: true,\n\tpartialEndOK: true\n};\n\nfunction helper(props, moreProps, xAccessor, width) {\n\tvar realXScale = moreProps.xScale,\n\t    yScale = moreProps.chartConfig.yScale,\n\t    plotData = moreProps.plotData;\n\tvar sessionStart = props.sessionStart,\n\t    bySession = props.bySession,\n\t    partialStartOK = props.partialStartOK,\n\t    partialEndOK = props.partialEndOK;\n\tvar bins = props.bins,\n\t    maxProfileWidthPercent = props.maxProfileWidthPercent,\n\t    source = props.source,\n\t    volume = props.volume,\n\t    absoluteChange = props.absoluteChange,\n\t    orient = props.orient,\n\t    fill = props.fill,\n\t    stroke = props.stroke;\n\n\n\tvar sessionBuilder = (0, _utils.accumulatingWindow)().discardTillStart(!partialStartOK).discardTillEnd(!partialEndOK).accumulateTill(function (d, i) {\n\t\treturn sessionStart(_extends({ d: d, i: i }, moreProps));\n\t}).accumulator(_utils.identity);\n\n\tvar dx = plotData.length > 1 ? realXScale(xAccessor(plotData[1])) - realXScale(xAccessor((0, _utils.head)(plotData))) : 0;\n\n\tvar sessions = bySession ? sessionBuilder(plotData) : [plotData];\n\n\tvar allRects = sessions.map(function (session) {\n\n\t\tvar begin = bySession ? realXScale(xAccessor((0, _utils.head)(session))) : 0;\n\t\tvar finish = bySession ? realXScale(xAccessor((0, _utils.last)(session))) : width;\n\t\tvar sessionWidth = finish - begin + dx;\n\n\t\t// console.log(session)\n\n\t\t/* var histogram = d3.layout.histogram()\n  \t\t.value(source)\n  \t\t.bins(bins);*/\n\n\t\tvar histogram2 = (0, _d3Array.histogram)()\n\t\t// .domain(xScale.domain())\n\t\t.value(source).thresholds(bins);\n\n\t\t// console.log(bins, histogram(session))\n\t\t// console.log(bins, histogram2(session))\n\t\tvar rollup = (0, _d3Collection.nest)().key(function (d) {\n\t\t\treturn d.direction;\n\t\t}).sortKeys(orient === \"right\" ? _d3Array.descending : _d3Array.ascending).rollup(function (leaves) {\n\t\t\treturn (0, _d3Array.sum)(leaves, function (d) {\n\t\t\t\treturn d.volume;\n\t\t\t});\n\t\t});\n\n\t\tvar values = histogram2(session);\n\t\t// console.log(\"values\", values)\n\n\t\tvar volumeInBins = values.map(function (arr) {\n\t\t\treturn arr.map(function (d) {\n\t\t\t\treturn absoluteChange(d) > 0 ? { direction: \"up\", volume: volume(d) } : { direction: \"down\", volume: volume(d) };\n\t\t\t});\n\t\t}).map(function (arr) {\n\t\t\treturn rollup.entries(arr);\n\t\t});\n\n\t\t// console.log(\"volumeInBins\", volumeInBins)\n\t\tvar volumeValues = volumeInBins.map(function (each) {\n\t\t\treturn (0, _d3Array.sum)(each.map(function (d) {\n\t\t\t\treturn d.value;\n\t\t\t}));\n\t\t});\n\n\t\t// console.log(\"volumeValues\", volumeValues)\n\t\tvar base = function base(xScale) {\n\t\t\treturn (0, _utils.head)(xScale.range());\n\t\t};\n\n\t\tvar _ref3 = orient === \"right\" ? [begin, begin + sessionWidth * maxProfileWidthPercent / 100] : [finish, finish - sessionWidth * (100 - maxProfileWidthPercent) / 100],\n\t\t    _ref4 = _slicedToArray(_ref3, 2),\n\t\t    start = _ref4[0],\n\t\t    end = _ref4[1];\n\n\t\tvar xScale = (0, _d3Scale.scaleLinear)().domain([0, (0, _d3Array.max)(volumeValues)]).range([start, end]);\n\n\t\t// console.log(xScale.domain())\n\n\t\tvar totalVolumes = volumeInBins.map(function (volumes) {\n\n\t\t\tvar totalVolume = (0, _d3Array.sum)(volumes, function (d) {\n\t\t\t\treturn d.value;\n\t\t\t});\n\t\t\tvar totalVolumeX = xScale(totalVolume);\n\t\t\tvar width = base(xScale) - totalVolumeX;\n\t\t\tvar x = width < 0 ? totalVolumeX + width : totalVolumeX;\n\n\t\t\tvar ws = volumes.map(function (d) {\n\t\t\t\treturn {\n\t\t\t\t\ttype: d.key,\n\t\t\t\t\twidth: d.value * Math.abs(width) / totalVolume\n\t\t\t\t};\n\t\t\t});\n\n\t\t\treturn { x: x, ws: ws, totalVolumeX: totalVolumeX };\n\t\t});\n\t\t// console.log(\"totalVolumes\", totalVolumes)\n\n\t\tvar rects = (0, _d3Array.zip)(values, totalVolumes).map(function (_ref5) {\n\t\t\tvar _ref6 = _slicedToArray(_ref5, 2),\n\t\t\t    d = _ref6[0],\n\t\t\t    _ref6$ = _ref6[1],\n\t\t\t    x = _ref6$.x,\n\t\t\t    ws = _ref6$.ws;\n\n\t\t\tvar w1 = ws[0] || { type: \"up\", width: 0 };\n\t\t\tvar w2 = ws[1] || { type: \"down\", width: 0 };\n\n\t\t\treturn {\n\t\t\t\t// y: yScale(d.x + d.dx),\n\t\t\t\ty: yScale(d.x1),\n\t\t\t\t// height: yScale(d.x - d.dx) - yScale(d.x),\n\t\t\t\theight: yScale(d.x1) - yScale(d.x0),\n\t\t\t\tx: x,\n\t\t\t\twidth: width,\n\t\t\t\tw1: w1.width,\n\t\t\t\tw2: w2.width,\n\t\t\t\tstroke1: (0, _utils.functor)(stroke)(w1),\n\t\t\t\tstroke2: (0, _utils.functor)(stroke)(w2),\n\t\t\t\tfill1: (0, _utils.functor)(fill)(w1),\n\t\t\t\tfill2: (0, _utils.functor)(fill)(w2)\n\t\t\t};\n\t\t});\n\n\t\t// console.log(\"rects\", rects)\n\n\t\tvar sessionBg = {\n\t\t\tx: begin,\n\t\t\ty: (0, _utils.last)(rects).y,\n\t\t\theight: (0, _utils.head)(rects).y - (0, _utils.last)(rects).y + (0, _utils.head)(rects).height,\n\t\t\twidth: sessionWidth\n\t\t};\n\n\t\treturn { rects: rects, sessionBg: sessionBg };\n\t});\n\n\treturn {\n\t\trects: (0, _d3Array.merge)(allRects.map(function (d) {\n\t\t\treturn d.rects;\n\t\t})),\n\t\tsessionBg: allRects.map(function (d) {\n\t\t\treturn d.sessionBg;\n\t\t})\n\t};\n}\n\nfunction _drawOnCanvas(ctx, props, rects, sessionBg) {\n\tvar opacity = props.opacity,\n\t    sessionBackGround = props.sessionBackGround,\n\t    sessionBackGroundOpacity = props.sessionBackGroundOpacity,\n\t    showSessionBackground = props.showSessionBackground;\n\n\t// var { rects, sessionBg } = helper(props, xScale, yScale, plotData);\n\n\tif (showSessionBackground) {\n\t\tctx.fillStyle = (0, _utils.hexToRGBA)(sessionBackGround, sessionBackGroundOpacity);\n\n\t\tsessionBg.forEach(function (each) {\n\t\t\tvar x = each.x,\n\t\t\t    y = each.y,\n\t\t\t    height = each.height,\n\t\t\t    width = each.width;\n\n\n\t\t\tctx.beginPath();\n\t\t\tctx.rect(x, y, width, height);\n\t\t\tctx.closePath();\n\t\t\tctx.fill();\n\t\t});\n\t}\n\n\trects.forEach(function (each) {\n\t\tvar x = each.x,\n\t\t    y = each.y,\n\t\t    height = each.height,\n\t\t    w1 = each.w1,\n\t\t    w2 = each.w2,\n\t\t    stroke1 = each.stroke1,\n\t\t    stroke2 = each.stroke2,\n\t\t    fill1 = each.fill1,\n\t\t    fill2 = each.fill2;\n\n\n\t\tif (w1 > 0) {\n\t\t\tctx.fillStyle = (0, _utils.hexToRGBA)(fill1, opacity);\n\t\t\tif (stroke1 !== \"none\") ctx.strokeStyle = stroke1;\n\n\t\t\tctx.beginPath();\n\t\t\tctx.rect(x, y, w1, height);\n\t\t\tctx.closePath();\n\t\t\tctx.fill();\n\n\t\t\tif (stroke1 !== \"none\") ctx.stroke();\n\t\t}\n\n\t\tif (w2 > 0) {\n\t\t\tctx.fillStyle = (0, _utils.hexToRGBA)(fill2, opacity);\n\t\t\tif (stroke2 !== \"none\") ctx.strokeStyle = stroke2;\n\n\t\t\tctx.beginPath();\n\t\t\tctx.rect(x + w1, y, w2, height);\n\t\t\tctx.closePath();\n\t\t\tctx.fill();\n\n\t\t\tif (stroke2 !== \"none\") ctx.stroke();\n\t\t}\n\t});\n}\n\nexports.default = VolumeProfileSeries;\n"},"sourceMaps":{"js":{"version":3,"sources":["../../../src/lib/series/VolumeProfileSeries.js"],"names":["VolumeProfileSeries","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","xAccessor","width","helper","rects","sessionBg","className","opacity","showSessionBackground","sessionBackGround","sessionBackGroundOpacity","sessionBgSvg","map","d","idx","i","x","y","w1","height","fill1","stroke1","w2","fill2","stroke2","propTypes","string","number","bool","defaultProps","bins","maxProfileWidthPercent","fill","type","stroke","source","close","volume","absoluteChange","bySession","sessionStart","plotData","date","getMonth","orient","partialStartOK","partialEndOK","realXScale","xScale","yScale","chartConfig","sessionBuilder","discardTillStart","discardTillEnd","accumulateTill","accumulator","dx","length","sessions","allRects","begin","session","finish","sessionWidth","histogram2","value","thresholds","rollup","key","direction","sortKeys","leaves","values","volumeInBins","arr","entries","volumeValues","each","base","range","start","end","domain","totalVolumes","totalVolume","volumes","totalVolumeX","ws","Math","abs","x1","x0","fillStyle","forEach","beginPath","rect","closePath","strokeStyle"],"mappings":"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","file":"VolumeProfileSeries.js","sourcesContent":["\n\nimport React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\n\nimport { ascending, descending, sum, max, merge, zip, histogram as d3Histogram } from \"d3-array\";\nimport { nest } from \"d3-collection\";\nimport { scaleLinear } from \"d3-scale\";\n\nimport GenericChartComponent from \"../GenericChartComponent\";\nimport { getAxisCanvas } from \"../GenericComponent\";\n\nimport { head, last, hexToRGBA, accumulatingWindow, identity, functor } from \"../utils\";\n\nclass VolumeProfileSeries extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.renderSVG = this.renderSVG.bind(this);\n\t\tthis.drawOnCanvas = this.drawOnCanvas.bind(this);\n\t}\n\tdrawOnCanvas(ctx, moreProps) {\n\t\tconst { xAccessor, width } = moreProps;\n\t\tconst { rects, sessionBg } = helper(this.props, moreProps, xAccessor, width);\n\n\t\tdrawOnCanvas(ctx, this.props, rects, sessionBg);\n\t}\n\trender() {\n\t\treturn <GenericChartComponent\n\t\t\tsvgDraw={this.renderSVG}\n\t\t\tcanvasDraw={this.drawOnCanvas}\n\t\t\tcanvasToDraw={getAxisCanvas}\n\t\t\tdrawOn={[\"pan\"]}\n\t\t/>;\n\t}\n\trenderSVG(moreProps) {\n\t\tconst { className, opacity } = this.props;\n\t\tconst { showSessionBackground, sessionBackGround, sessionBackGroundOpacity } = this.props;\n\n\t\tconst { xAccessor, width } = moreProps;\n\t\tconst { rects, sessionBg } = helper(this.props, moreProps, xAccessor, width);\n\n\t\tconst sessionBgSvg = showSessionBackground\n\t\t\t? sessionBg.map((d, idx) => <rect key={idx} {...d} opacity={sessionBackGroundOpacity} fill={sessionBackGround} />)\n\t\t\t: null;\n\n\t\treturn <g className={className}>\n\t\t\t{sessionBgSvg}\n\t\t\t{rects.map((d, i) => <g key={i}>\n\t\t\t\t<rect x={d.x} y={d.y}\n\t\t\t\t\twidth={d.w1} height={d.height}\n\t\t\t\t\tfill={d.fill1} stroke={d.stroke1} fillOpacity={opacity} />\n\t\t\t\t<rect x={d.x + d.w1} y={d.y}\n\t\t\t\t\twidth={d.w2} height={d.height}\n\t\t\t\t\tfill={d.fill2} stroke={d.stroke2} fillOpacity={opacity} />\n\t\t\t</g>)}\n\t\t</g>;\n\t}\n}\n\nVolumeProfileSeries.propTypes = {\n\tclassName: PropTypes.string,\n\topacity: PropTypes.number,\n\tshowSessionBackground: PropTypes.bool,\n\tsessionBackGround: PropTypes.string,\n\tsessionBackGroundOpacity: PropTypes.number,\n};\n\n\nVolumeProfileSeries.defaultProps = {\n\tclassName: \"line \",\n\tbins: 20,\n\topacity: 0.5,\n\tmaxProfileWidthPercent: 50,\n\tfill: ({ type }) => type === \"up\" ? \"#6BA583\" : \"#FF0000\",\n\tstroke: \"#FFFFFF\",\n\tshowSessionBackground: false,\n\tsessionBackGround: \"#4682B4\",\n\tsessionBackGroundOpacity: 0.3,\n\n\tsource: d => d.close,\n\tvolume: d => d.volume,\n\tabsoluteChange: d => d.absoluteChange,\n\tbySession: false,\n\t/* eslint-disable no-unused-vars */\n\tsessionStart: ({ d, i, plotData }) => i > 0 && plotData[i - 1].date.getMonth() !== d.date.getMonth(),\n\t/* eslint-enable no-unused-vars */\n\torient: \"left\",\n\t// // fill: ({ type }) => { var c = type === \"up\" ? \"#6BA583\" : \"#FF0000\"; console.log(type, c); return c },\n\t// stroke: ({ type }) =>  type === \"up\" ? \"#6BA583\" : \"#FF0000\",\n\t// stroke: \"none\",\n\tpartialStartOK: true,\n\tpartialEndOK: true,\n};\n\nfunction helper(props, moreProps, xAccessor, width) {\n\tconst { xScale: realXScale, chartConfig: { yScale }, plotData } = moreProps;\n\n\tconst { sessionStart, bySession, partialStartOK, partialEndOK } = props;\n\tconst { bins, maxProfileWidthPercent, source, volume, absoluteChange, orient, fill, stroke } = props;\n\n\tconst sessionBuilder = accumulatingWindow()\n\t\t.discardTillStart(!partialStartOK)\n\t\t.discardTillEnd(!partialEndOK)\n\t\t.accumulateTill((d, i) => {\n\t\t\treturn sessionStart({ d, i, ...moreProps });\n\t\t})\n\t\t.accumulator(identity);\n\n\tconst dx = plotData.length > 1 ? realXScale(xAccessor(plotData[1])) - realXScale(xAccessor(head(plotData))) : 0;\n\n\tconst sessions = bySession ? sessionBuilder(plotData) : [plotData];\n\n\tconst allRects = sessions.map(session => {\n\n\t\tconst begin = bySession ? realXScale(xAccessor(head(session))) : 0;\n\t\tconst finish = bySession ? realXScale(xAccessor(last(session))) : width;\n\t\tconst sessionWidth = finish - begin + dx;\n\n\t\t// console.log(session)\n\n\t\t/* var histogram = d3.layout.histogram()\n\t\t\t\t.value(source)\n\t\t\t\t.bins(bins);*/\n\n\t\tconst histogram2 = d3Histogram()\n\t\t\t// .domain(xScale.domain())\n\t\t\t.value(source)\n\t\t\t.thresholds(bins);\n\n\t\t// console.log(bins, histogram(session))\n\t\t// console.log(bins, histogram2(session))\n\t\tconst rollup = nest()\n\t\t\t.key(d => d.direction)\n\t\t\t.sortKeys(orient === \"right\" ? descending : ascending)\n\t\t\t.rollup(leaves => sum(leaves, d => d.volume));\n\n\t\tconst values = histogram2(session);\n\t\t// console.log(\"values\", values)\n\n\t\tconst volumeInBins = values\n\t\t\t.map(arr => arr.map(d => absoluteChange(d) > 0 ? { direction: \"up\", volume: volume(d) } : { direction: \"down\", volume: volume(d) }))\n\t\t\t.map(arr => rollup.entries(arr));\n\n\t\t// console.log(\"volumeInBins\", volumeInBins)\n\t\tconst volumeValues = volumeInBins\n\t\t\t.map(each => sum(each.map(d => d.value)));\n\n\t\t// console.log(\"volumeValues\", volumeValues)\n\t\tconst base = xScale => head(xScale.range());\n\n\t\tconst [start, end] = orient === \"right\"\n\t\t\t? [begin, begin + sessionWidth * maxProfileWidthPercent / 100]\n\t\t\t: [finish, finish - sessionWidth * (100 - maxProfileWidthPercent) / 100];\n\n\t\tconst xScale = scaleLinear()\n\t\t\t.domain([0, max(volumeValues)])\n\t\t\t.range([start, end]);\n\n\t\t// console.log(xScale.domain())\n\n\t\tconst totalVolumes = volumeInBins.map(volumes => {\n\n\t\t\tconst totalVolume = sum(volumes, d => d.value);\n\t\t\tconst totalVolumeX = xScale(totalVolume);\n\t\t\tconst width = base(xScale) - totalVolumeX;\n\t\t\tconst x = width < 0 ? totalVolumeX + width : totalVolumeX;\n\n\t\t\tconst ws = volumes.map(d => {\n\t\t\t\treturn {\n\t\t\t\t\ttype: d.key,\n\t\t\t\t\twidth: d.value * Math.abs(width) / totalVolume,\n\t\t\t\t};\n\t\t\t});\n\n\t\t\treturn { x, ws, totalVolumeX };\n\t\t});\n\t\t// console.log(\"totalVolumes\", totalVolumes)\n\n\t\tconst rects = zip(values, totalVolumes)\n\t\t\t.map(([d, { x, ws }]) => {\n\t\t\t\tconst w1 = ws[0] || { type: \"up\", width: 0 };\n\t\t\t\tconst w2 = ws[1] || { type: \"down\", width: 0 };\n\n\t\t\t\treturn {\n\t\t\t\t\t// y: yScale(d.x + d.dx),\n\t\t\t\t\ty: yScale(d.x1),\n\t\t\t\t\t// height: yScale(d.x - d.dx) - yScale(d.x),\n\t\t\t\t\theight: yScale(d.x1) - yScale(d.x0),\n\t\t\t\t\tx,\n\t\t\t\t\twidth,\n\t\t\t\t\tw1: w1.width,\n\t\t\t\t\tw2: w2.width,\n\t\t\t\t\tstroke1: functor(stroke)(w1),\n\t\t\t\t\tstroke2: functor(stroke)(w2),\n\t\t\t\t\tfill1: functor(fill)(w1),\n\t\t\t\t\tfill2: functor(fill)(w2),\n\t\t\t\t};\n\t\t\t});\n\n\t\t// console.log(\"rects\", rects)\n\n\t\tconst sessionBg = {\n\t\t\tx: begin,\n\t\t\ty: last(rects).y,\n\t\t\theight: head(rects).y - last(rects).y + head(rects).height,\n\t\t\twidth: sessionWidth,\n\t\t};\n\n\t\treturn { rects, sessionBg };\n\t});\n\n\treturn {\n\t\trects: merge(allRects.map(d => d.rects)),\n\t\tsessionBg: allRects.map(d => d.sessionBg),\n\t};\n}\n\n\nfunction drawOnCanvas(ctx, props, rects, sessionBg) {\n\tconst { opacity, sessionBackGround, sessionBackGroundOpacity, showSessionBackground } = props;\n\n\t// var { rects, sessionBg } = helper(props, xScale, yScale, plotData);\n\n\tif (showSessionBackground) {\n\t\tctx.fillStyle = hexToRGBA(sessionBackGround, sessionBackGroundOpacity);\n\n\t\tsessionBg.forEach(each => {\n\t\t\tconst { x, y, height, width } = each;\n\n\t\t\tctx.beginPath();\n\t\t\tctx.rect(x, y, width, height);\n\t\t\tctx.closePath();\n\t\t\tctx.fill();\n\t\t});\n\t}\n\n\trects.forEach(each => {\n\t\tconst { x, y, height, w1, w2, stroke1, stroke2, fill1, fill2 } = each;\n\n\n\t\tif (w1 > 0) {\n\t\t\tctx.fillStyle = hexToRGBA(fill1, opacity);\n\t\t\tif (stroke1 !== \"none\") ctx.strokeStyle = stroke1;\n\n\t\t\tctx.beginPath();\n\t\t\tctx.rect(x, y, w1, height);\n\t\t\tctx.closePath();\n\t\t\tctx.fill();\n\n\t\t\tif (stroke1 !== \"none\") ctx.stroke();\n\t\t}\n\n\t\tif (w2 > 0) {\n\t\t\tctx.fillStyle = hexToRGBA(fill2, opacity);\n\t\t\tif (stroke2 !== \"none\") ctx.strokeStyle = stroke2;\n\n\t\t\tctx.beginPath();\n\t\t\tctx.rect(x + w1, y, w2, height);\n\t\t\tctx.closePath();\n\t\t\tctx.fill();\n\n\t\t\tif (stroke2 !== \"none\") ctx.stroke();\n\t\t}\n\n\t});\n}\n\nexport default VolumeProfileSeries;\n"]}},"error":null,"hash":"6a1a7b759bf5addedb092260b82def4c","cacheData":{"env":{}}}